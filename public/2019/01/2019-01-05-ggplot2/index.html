<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>ggplot2 | hoas&#39; blog | One Stupid Boy</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="ggplot的一些笔记整理">
<link rel="next" href="/2019/02/2019-02-12-tables-in-website/" />
<link rel="canonical" href="/2019/01/2019-01-05-ggplot2/" />
<link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ggplot2"/>
<meta name="twitter:description" content="ggplot的一些笔记整理"/>
<script type="application/ld+json">
    {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "ggplot2",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "\/2019\/01\/2019-01-05-ggplot2\/"
    },
    
        "image": {
            "@type": "ImageObject",
            "url": "\/images\/hoas.png",
            "width":  800 ,
            "height":  600 
        },
    
    "genre": "posts",
    
        "keywords": "R, ggplot2",
    
    "wordcount":  2667 ,
    "url": "\/2019\/01\/2019-01-05-ggplot2\/",
    
        "datePublished": "2019-01-05T00:00:00\x2b00:00",
    
    
        "dateModified": "2019-01-05T13:04:48\x2b08:00",
    
    
        "license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.",
    
    
        "publisher": {
            "@type": "Organization",
            "name": "XXXX",
            "logo": {
            "@type": "ImageObject",
            "url": "\/images\/hoas.png",
            "width":  127 ,
            "height":  40 
            }
        },
    
    
    "description": "ggplot的一些笔记整理"
    }
    </script>
<link rel="stylesheet" href="/css/style.min.css">
<link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.min.css">

<link rel="stylesheet" href="/css/lib/animate/animate.min.min.css">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    </head>
    <body>
        <script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script>
        <div class="wrapper">
            <nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header">
            <a href="/">hoas&#39; blog | One Stupid Boy</a>
        </div>
        <div class="navbar-menu">
            
            
                <a class="menu-item" href="/posts/" title="">文章</a>
            
                <a class="menu-item" href="/tags/" title="">标签</a>
            
                <a class="menu-item" href="/categories/" title="">归档</a>
            
                <a class="menu-item" href="/about/" title="">关于</a>
            
            <a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a>
        </div>
    </div>
</nav>
<nav class="navbar-mobile">
     <div class="navbar-container">
        <div class="navbar-header">
            <div><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a><a href="/">hoas&#39; blog | One Stupid Boy</a></div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu">
            
            
                <a class="menu-item" href="/posts/" title="">文章</a>
            
                <a class="menu-item" href="/tags/" title="">标签</a>
            
                <a class="menu-item" href="/categories/" title="">归档</a>
            
                <a class="menu-item" href="/about/" title="">关于</a>
            
        </div>
    </div>
</nav><main class="main">
                <div class="container">
                    
    
    
    
       
    

    <article class="post-warp">
        <h1 class="post-title animated flipInX">ggplot2</h1>

        <div class="post-meta">
            <div class="post-meta-main">
                <a class="author" href="/" rel="author"><i class="fas fa-user-circle fa-fw"></i>hoas&nbsp;</a>
                <span class="post-category">
                        收录于
                        <i class="far fa-folder fa-fw"></i><a href="/categories/notes/">notes</a>
                            
                    </span>
            </div>
            <div class="post-meta-other">
                <i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-01-05>2019-01-05</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>约 2667 字&nbsp;
                <i class="far fa-clock fa-fw"></i>预计阅读 6 分钟&nbsp;</div>
        </div>

        

        <div class="post-toc" id="post-toc">
                <h2 class="post-toc-title">目录</h2>
                <div class="post-toc-content">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#expressionannotategreek-letterstitle">expression/annotate/Greek letters/title</a></li>
    <li><a href="#extra-dashed-lines">extra dashed lines</a></li>
    <li><a href="#the-legend">the legend</a></li>
    <li><a href="#double-y-axis">double y-axis</a></li>
  </ul>
</nav>
                </div>
            </div>
            <div class="post-toc-mobile" id="post-toc-mobile">
                <details>
                    <summary><div class="post-toc-title"><span>目录</span><span><i class="details icon fas fa-angle-down"></i></span></div></summary>
                    <div class="post-toc-content">
                        
                        
                        <nav id="TableOfContentsMobile">
  <ul>
    <li><a href="#expressionannotategreek-letterstitle">expression/annotate/Greek letters/title</a></li>
    <li><a href="#extra-dashed-lines">extra dashed lines</a></li>
    <li><a href="#the-legend">the legend</a></li>
    <li><a href="#double-y-axis">double y-axis</a></li>
  </ul>
</nav>
                    </div>
                </details>
            </div>

        <div class="post-content">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <p>There are brief notes about the usage of <strong>ggplot2</strong>.</p>
<a class="post-dummy-target" id="expressionannotategreek-letterstitle"></a><h2>expression/annotate/Greek letters/title</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">t</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">0.1</span><span class="p">)</span>
<span class="n">qmp</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="m">0.278</span><span class="o">*</span><span class="p">(</span><span class="m">98.92</span><span class="o">/</span><span class="n">t</span><span class="n">^0.65</span><span class="m">-2</span><span class="p">)</span><span class="o">*</span><span class="m">78</span>
<span class="p">}</span>

<span class="n">q</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">500</span><span class="p">,</span><span class="m">2000</span><span class="p">,</span><span class="m">75</span><span class="p">)</span>
<span class="n">tao</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{</span>
  <span class="m">0.278</span><span class="o">*</span><span class="m">14.6</span><span class="o">/</span><span class="m">0.96</span><span class="o">/</span><span class="m">0.296</span><span class="o">/</span><span class="n">q</span><span class="n">^0.25</span>
<span class="p">}</span>

<span class="nf">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">qmp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="p">)</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">red&#34;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="nf">tao</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="p">)</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#39;</span><span class="s">blue&#39;</span><span class="p">,</span><span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">dashed&#34;</span><span class="p">,</span><span class="n">show.legend</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">9-2&#34;</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">(h)&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="n">Q</span><span class="n">[mp</span><span class="nf">]</span><span class="p">(</span><span class="n">m</span><span class="n">^3</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">background_grid</span><span class="p">(</span><span class="n">major</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">xy&#34;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;</span><span class="s">text&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1.5</span><span class="p">,</span><span class="m">2.6</span><span class="p">)</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1400</span><span class="p">,</span><span class="m">1500</span><span class="p">)</span><span class="p">,</span>
           <span class="n">label</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">Q</span><span class="n">[mp</span><span class="n">]</span><span class="p">,</span><span class="s">&#34;</span><span class="s">~&#34;</span><span class="p">,</span><span class="n">tau</span><span class="p">)</span><span class="p">)</span><span class="p">,</span><span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span><span class="s">&#39;</span><span class="s">~&#39;</span><span class="p">,</span><span class="n">Q</span><span class="n">[mp</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>

<span class="n">z_xx</span> <span class="o">&lt;-</span> <span class="m">214</span> <span class="c1">#堰顶高程就是正常蓄水位，也就是汛限水位</span>
<span class="n">z_fh</span> <span class="o">&lt;-</span> <span class="m">228</span>
<span class="n">z_sj</span> <span class="o">&lt;-</span> <span class="m">229.63</span>
<span class="n">z_jh</span> <span class="o">&lt;-</span> <span class="m">231.27</span>
<span class="n">xi_q</span> <span class="o">&lt;-</span> <span class="m">1</span>

<span class="n">tbl</span> <span class="o">&lt;-</span> <span class="nf">structure</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">t</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">11</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">13</span><span class="p">,</span> 
                     <span class="m">14</span><span class="p">,</span> <span class="m">15</span><span class="p">,</span> <span class="m">16</span><span class="p">,</span> <span class="m">17</span><span class="p">,</span> <span class="m">18</span><span class="p">,</span> <span class="m">19</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> <span class="m">21</span><span class="p">,</span> <span class="m">22</span><span class="p">,</span> <span class="m">23</span><span class="p">,</span> <span class="m">24</span><span class="p">,</span> <span class="m">25</span><span class="p">,</span> <span class="m">26</span><span class="p">,</span> <span class="m">27</span><span class="p">,</span> <span class="m">28</span><span class="p">,</span> <span class="m">29</span><span class="p">,</span> 
                     <span class="m">30</span><span class="p">,</span> <span class="m">31</span><span class="p">,</span> <span class="m">32</span><span class="p">,</span> <span class="m">33</span><span class="p">,</span> <span class="m">34</span><span class="p">,</span> <span class="m">35</span><span class="p">,</span> <span class="m">36</span><span class="p">,</span> <span class="m">37</span><span class="p">,</span> <span class="m">38</span><span class="p">,</span> <span class="m">39</span><span class="p">,</span> <span class="m">40</span><span class="p">,</span> <span class="m">41</span><span class="p">,</span> <span class="m">42</span><span class="p">,</span> <span class="m">43</span><span class="p">,</span> <span class="m">44</span><span class="p">,</span> <span class="m">45</span><span class="p">,</span> 
                     <span class="m">46</span><span class="p">,</span> <span class="m">47</span><span class="p">,</span> <span class="m">48</span><span class="p">,</span> <span class="m">49</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="m">51</span><span class="p">,</span> <span class="m">52</span><span class="p">,</span> <span class="m">53</span><span class="p">,</span> <span class="m">54</span><span class="p">,</span> <span class="m">55</span><span class="p">,</span> <span class="m">56</span><span class="p">,</span> <span class="m">57</span><span class="p">,</span> <span class="m">58</span><span class="p">,</span> <span class="m">59</span><span class="p">,</span> <span class="m">60</span><span class="p">,</span> <span class="m">61</span><span class="p">,</span> 
                     <span class="m">62</span><span class="p">,</span> <span class="m">63</span><span class="p">,</span> <span class="m">64</span><span class="p">,</span> <span class="m">65</span><span class="p">,</span> <span class="m">66</span><span class="p">,</span> <span class="m">67</span><span class="p">,</span> <span class="m">68</span><span class="p">,</span> <span class="m">69</span><span class="p">,</span> <span class="m">70</span><span class="p">,</span> <span class="m">71</span><span class="p">,</span> <span class="m">72</span><span class="p">,</span> <span class="m">73</span><span class="p">,</span> <span class="m">74</span><span class="p">,</span> <span class="m">75</span><span class="p">,</span> <span class="m">76</span><span class="p">,</span> <span class="m">77</span><span class="p">,</span> 
                     <span class="m">78</span><span class="p">,</span> <span class="m">79</span><span class="p">,</span> <span class="m">80</span><span class="p">,</span> <span class="m">81</span><span class="p">,</span> <span class="m">82</span><span class="p">,</span> <span class="m">83</span><span class="p">,</span> <span class="m">84</span><span class="p">,</span> <span class="m">85</span><span class="p">,</span> <span class="m">86</span><span class="p">,</span> <span class="m">87</span><span class="p">,</span> <span class="m">88</span><span class="p">,</span> <span class="m">89</span><span class="p">,</span> <span class="m">90</span><span class="p">)</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">634.6</span><span class="p">,</span> 
                                                                                <span class="m">648.1</span><span class="p">,</span> <span class="m">681</span><span class="p">,</span> <span class="m">713.8</span><span class="p">,</span> <span class="m">746.7</span><span class="p">,</span> <span class="m">779.5</span><span class="p">,</span> <span class="m">812.4</span><span class="p">,</span> <span class="m">845.3</span><span class="p">,</span> <span class="m">878.1</span><span class="p">,</span> <span class="m">911</span><span class="p">,</span> <span class="m">943.8</span><span class="p">,</span> 
                                                                                <span class="m">976.7</span><span class="p">,</span> <span class="m">1009.5</span><span class="p">,</span> <span class="m">1164.9</span><span class="p">,</span> <span class="m">1442.7</span><span class="p">,</span> <span class="m">1720.6</span><span class="p">,</span> <span class="m">1998.4</span><span class="p">,</span> <span class="m">2276.3</span><span class="p">,</span> <span class="m">2554.2</span><span class="p">,</span> 
                                                                                <span class="m">2832</span><span class="p">,</span> <span class="m">3109.9</span><span class="p">,</span> <span class="m">3387.7</span><span class="p">,</span> <span class="m">3665.6</span><span class="p">,</span> <span class="m">3943.5</span><span class="p">,</span> <span class="m">4221.3</span><span class="p">,</span> <span class="m">4502.3</span><span class="p">,</span> <span class="m">4786.5</span><span class="p">,</span> 
                                                                                <span class="m">5070.7</span><span class="p">,</span> <span class="m">5354.9</span><span class="p">,</span> <span class="m">5639.1</span><span class="p">,</span> <span class="m">5923.3</span><span class="p">,</span> <span class="m">6207.5</span><span class="p">,</span> <span class="m">6491.7</span><span class="p">,</span> <span class="m">6775.9</span><span class="p">,</span> <span class="m">7060.1</span><span class="p">,</span> 
                                                                                <span class="m">7344.3</span><span class="p">,</span> <span class="m">7628.4</span><span class="p">,</span> <span class="m">7711.6</span><span class="p">,</span> <span class="m">7593.6</span><span class="p">,</span> <span class="m">7475.7</span><span class="p">,</span> <span class="m">7357.7</span><span class="p">,</span> <span class="m">7239.8</span><span class="p">,</span> <span class="m">7121.8</span><span class="p">,</span> 
                                                                                <span class="m">7003.9</span><span class="p">,</span> <span class="m">6885.9</span><span class="p">,</span> <span class="m">6768</span><span class="p">,</span> <span class="m">6650</span><span class="p">,</span> <span class="m">6532.1</span><span class="p">,</span> <span class="m">6414.1</span><span class="p">,</span> <span class="m">6268.4</span><span class="p">,</span> <span class="m">6095.1</span><span class="p">,</span> <span class="m">5921.7</span><span class="p">,</span> 
                                                                                <span class="m">5748.4</span><span class="p">,</span> <span class="m">5575</span><span class="p">,</span> <span class="m">5401.6</span><span class="p">,</span> <span class="m">5228.3</span><span class="p">,</span> <span class="m">5054.9</span><span class="p">,</span> <span class="m">4881.5</span><span class="p">,</span> <span class="m">4708.2</span><span class="p">,</span> <span class="m">4534.8</span><span class="p">,</span> 
                                                                                <span class="m">4361.4</span><span class="p">,</span> <span class="m">4209.4</span><span class="p">,</span> <span class="m">4078.8</span><span class="p">,</span> <span class="m">3948.2</span><span class="p">,</span> <span class="m">3817.6</span><span class="p">,</span> <span class="m">3687</span><span class="p">,</span> <span class="m">3556.4</span><span class="p">,</span> <span class="m">3425.7</span><span class="p">,</span> 
                                                                                <span class="m">3295.1</span><span class="p">,</span> <span class="m">3164.5</span><span class="p">,</span> <span class="m">3033.9</span><span class="p">,</span> <span class="m">2903.3</span><span class="p">,</span> <span class="m">2772.7</span><span class="p">,</span> <span class="m">2678.1</span><span class="p">,</span> <span class="m">2619.5</span><span class="p">,</span> <span class="m">2560.9</span><span class="p">,</span> 
                                                                                <span class="m">2502.3</span><span class="p">,</span> <span class="m">2443.7</span><span class="p">,</span> <span class="m">2385.2</span><span class="p">,</span> <span class="m">2326.6</span><span class="p">,</span> <span class="m">2268</span><span class="p">,</span> <span class="m">2209.4</span><span class="p">,</span> <span class="m">2150.8</span><span class="p">,</span> <span class="m">2092.3</span><span class="p">,</span> 
                                                                                <span class="m">2033.7</span><span class="p">,</span> <span class="m">1989.7</span><span class="p">,</span> <span class="m">1960.4</span><span class="p">,</span> <span class="m">1931.2</span><span class="p">,</span> <span class="m">1901.9</span><span class="p">,</span> <span class="m">1872.6</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">row.names</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span> 
                                                                                                                                                <span class="m">-90L</span><span class="p">)</span><span class="p">,</span> <span class="n">class</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">tbl_df&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">tbl&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">data.frame&#34;</span><span class="p">)</span><span class="p">)</span>

<span class="n">bs</span> <span class="o">&lt;-</span> <span class="nf">structure</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">Z</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">170</span><span class="p">,</span> <span class="m">170.78</span><span class="p">,</span> <span class="m">175</span><span class="p">,</span> <span class="m">177.5</span><span class="p">,</span> <span class="m">180</span><span class="p">,</span> <span class="m">183.63</span><span class="p">,</span> <span class="m">185</span><span class="p">,</span> 
                           <span class="m">187.5</span><span class="p">,</span> <span class="m">190</span><span class="p">,</span> <span class="m">192.88</span><span class="p">,</span> <span class="m">195</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="m">200.54</span><span class="p">,</span> <span class="m">203</span><span class="p">,</span> <span class="m">205</span><span class="p">,</span> <span class="m">207.06</span><span class="p">,</span> <span class="m">210</span><span class="p">,</span> 
                           <span class="m">212.58</span><span class="p">,</span> <span class="m">214</span><span class="p">,</span> <span class="m">215</span><span class="p">,</span> <span class="m">217.33</span><span class="p">,</span> <span class="m">220</span><span class="p">,</span> <span class="m">221.76</span><span class="p">,</span> <span class="m">225</span><span class="p">,</span> <span class="m">228</span><span class="p">,</span> <span class="m">229.66</span><span class="p">,</span> <span class="m">230</span><span class="p">,</span> 
                           <span class="m">231.49</span><span class="p">,</span> <span class="m">233</span><span class="p">,</span> <span class="m">233.73</span><span class="p">)</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">4.79</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6.51</span><span class="p">,</span> <span class="m">7.4</span><span class="p">,</span> <span class="m">8.46</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">10.71</span><span class="p">,</span> 
                                                       <span class="m">12</span><span class="p">,</span> <span class="m">13.39</span><span class="p">,</span> <span class="m">15</span><span class="p">,</span> <span class="m">16.2</span><span class="p">,</span> <span class="m">19.63</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> <span class="m">21.88</span><span class="p">,</span> <span class="m">23.4</span><span class="p">,</span> <span class="m">25</span><span class="p">,</span> <span class="m">27.6</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span> <span class="m">31.6</span><span class="p">,</span> 
                                                       <span class="m">32.5</span><span class="p">,</span> <span class="m">35</span><span class="p">,</span> <span class="m">38.01</span><span class="p">,</span> <span class="m">40</span><span class="p">,</span> <span class="m">44.15</span><span class="p">,</span> <span class="m">48</span><span class="p">,</span> <span class="m">50.47</span><span class="p">,</span> <span class="m">50.98</span><span class="p">,</span> <span class="m">53.2</span><span class="p">,</span> <span class="m">55.49</span><span class="p">,</span> <span class="m">56.6</span>
                           <span class="p">)</span><span class="p">,</span> <span class="n">Qt</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">73</span><span class="p">,</span> <span class="m">120</span><span class="p">,</span> <span class="m">377</span><span class="p">,</span> <span class="m">593</span><span class="p">,</span> <span class="m">809</span><span class="p">,</span> <span class="m">948</span><span class="p">,</span> <span class="m">1000</span><span class="p">,</span> <span class="m">1080</span><span class="p">,</span> <span class="m">1160</span><span class="p">,</span> <span class="m">1241</span><span class="p">,</span> 
                                     <span class="m">1300</span><span class="p">,</span> <span class="m">1426</span><span class="p">,</span> <span class="m">1439</span><span class="p">,</span> <span class="m">1496</span><span class="p">,</span> <span class="m">1542</span><span class="p">,</span> <span class="m">1586</span><span class="p">,</span> <span class="m">1650</span><span class="p">,</span> <span class="m">2269</span><span class="p">,</span> <span class="m">2610</span><span class="p">,</span> <span class="m">2850</span><span class="p">,</span> <span class="m">3948</span><span class="p">,</span> 
                                     <span class="m">5207</span><span class="p">,</span> <span class="m">6320</span><span class="p">,</span> <span class="m">8370</span><span class="p">,</span> <span class="m">10719</span><span class="p">,</span> <span class="m">12019</span><span class="p">,</span> <span class="m">12285</span><span class="p">,</span> <span class="m">13666</span><span class="p">,</span> <span class="m">15065</span><span class="p">,</span> <span class="m">15065</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">row.names</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span> 
                                                                                                                 <span class="m">-30L</span><span class="p">)</span><span class="p">,</span> <span class="n">class</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">tbl_df&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">tbl&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">data.frame&#34;</span><span class="p">)</span><span class="p">)</span>

<span class="n">tbl1</span> <span class="o">&lt;-</span> <span class="n">tbl</span> <span class="o">%&gt;%</span> 
  <span class="nf">mutate</span><span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">$</span><span class="n">Q</span><span class="n">[1</span><span class="n">]</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="m">31.60</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="m">214</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">within</span><span class="p">(</span><span class="p">{</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">2</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="p">)</span><span class="p">{</span>
      <span class="nf">if</span><span class="p">(</span><span class="n">Q</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;</span> <span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Z</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Qt</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">z</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span><span class="o">$</span><span class="n">y</span><span class="p">)</span><span class="p">{</span>
        <span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">Q</span><span class="n">[i</span><span class="n">]</span>
        <span class="n">v</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">v</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span>
        <span class="n">z</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">z</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span>
      <span class="p">}</span> <span class="n">else</span> <span class="nf">if</span><span class="p">(</span><span class="p">(</span><span class="n">Q</span><span class="n">[i</span><span class="n">]</span> <span class="o">&gt;=</span> <span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Z</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Qt</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">z</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span><span class="o">$</span><span class="n">y</span><span class="p">)</span> <span class="o">&amp;</span> 
                <span class="p">(</span><span class="n">z</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;=</span> <span class="n">z_fh</span><span class="p">)</span><span class="p">)</span><span class="p">{</span>
        <span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Z</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Qt</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">z</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span><span class="o">$</span><span class="n">y</span>
        <span class="n">v</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">v</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span> <span class="o">+</span> <span class="m">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Q</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">Q</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span> <span class="o">-</span> <span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">q</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span><span class="o">*</span><span class="m">3600</span><span class="o">/</span><span class="m">100000000</span>
        <span class="n">z</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">V</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Z</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">v</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span><span class="o">$</span><span class="n">y</span>
      <span class="p">}</span> <span class="n">else</span> <span class="p">{</span> <span class="c1"># 没有进行到这一步</span>
        <span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">q</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span> <span class="o">+</span> <span class="nf">rnorm</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
        <span class="n">v</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Q</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">Q</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span> <span class="o">-</span> <span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">q</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span><span class="o">*</span><span class="m">3600</span><span class="o">/</span><span class="m">100000000</span> <span class="o">+</span> <span class="n">v</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span>
        <span class="n">q1</span> <span class="o">&lt;-</span> <span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">V</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Qt</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">v</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span><span class="o">$</span><span class="n">y</span>
        <span class="nf">while</span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">q1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">xi_q</span><span class="p">)</span><span class="p">{</span>
          <span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">q1</span><span class="p">)</span><span class="o">/</span><span class="m">2</span>
          <span class="n">v</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Q</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">Q</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span> <span class="o">-</span> <span class="n">q</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">q</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span><span class="p">)</span><span class="o">*</span><span class="m">3600</span><span class="o">/</span><span class="m">100000000</span> <span class="o">+</span> <span class="n">v</span><span class="n">[i</span><span class="m">-1</span><span class="n">]</span>
          <span class="n">q1</span> <span class="o">&lt;-</span> <span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">V</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Qt</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">v</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span><span class="o">$</span><span class="n">y</span>
        <span class="p">}</span>
        <span class="n">z</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">V</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bs</span><span class="o">$</span><span class="n">Z</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">v</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span><span class="o">$</span><span class="n">y</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>

<span class="n">plot_1q</span> <span class="o">&lt;-</span> <span class="n">tbl1</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">pivot_longer</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">,</span> <span class="n">names_to</span> <span class="o">=</span> <span class="s">&#39;</span><span class="s">name&#39;</span><span class="p">,</span> <span class="n">values_to</span> <span class="o">=</span> <span class="s">&#39;</span><span class="s">value&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">mutate_at</span><span class="p">(</span><span class="nf">vars</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="p">,</span> <span class="n">as.factor</span><span class="p">)</span> <span class="o">%&gt;%</span> 
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_bw</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">1.5</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1"># geom_smooth(method = myspline, se = FALSE, size = 1) +</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">plot.subtitle</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">vjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span>
    <span class="n">plot.caption</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">vjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span>
    <span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">,</span> <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
    <span class="n">legend.justification</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.99</span><span class="p">,</span> <span class="m">0.99</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">BS 水库调洪示意图&#34;</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">时间/h&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span>流量<span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="n">^3</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_linetype_manual</span><span class="p">(</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="p">,</span>
    <span class="n">breaks</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;</span><span class="s">Q&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="s">q&#39;</span><span class="p">)</span><span class="p">,</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">入库流量&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">下泄流量&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_color_manual</span><span class="p">(</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;</span><span class="s">#b7e778&#39;</span> <span class="p">,</span><span class="s">&#39;</span><span class="s">#40dab2&#39;</span><span class="p">)</span><span class="p">,</span>
    <span class="n">breaks</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;</span><span class="s">Q&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="s">q&#39;</span><span class="p">)</span><span class="p">,</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">入库流量&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">下泄流量&#34;</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="m">20</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">dotdash&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#be6283&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="m">63</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">dotdash&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#be6283&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>

<span class="n">plot_1z</span> <span class="o">&lt;-</span> <span class="n">tbl1</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_bw</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
    <span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">1.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;</span><span class="s">#fddede&#39;</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1"># geom_smooth(method = myspline, se = FALSE, size = 1) +</span>
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">plot.subtitle</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">vjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span>
    <span class="n">plot.caption</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">vjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span>
    <span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">,</span> <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
    <span class="n">legend.justification</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.99</span><span class="p">,</span> <span class="m">0.99</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">BS 水库水位变化图&#34;</span><span class="p">,</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">时间/h&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span>水位 <span class="o">/</span> <span class="n">m</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="m">20</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">dotdash&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#be6283&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="m">63</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">dotdash&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#be6283&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>

<span class="nf">plot_grid</span><span class="p">(</span><span class="n">plot_1q</span><span class="p">,</span> <span class="n">plot_1z</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">A&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">B&#34;</span><span class="p">)</span><span class="p">,</span> <span class="n">align</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">v&#34;</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">tbl2</span> <span class="o">&lt;-</span> <span class="n">bs</span> <span class="o">%&gt;%</span> 
  <span class="nf">filter</span><span class="p">(</span><span class="n">Z</span> <span class="o">&gt;=</span> <span class="n">z_xx</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="n">tibble</span><span class="o">::</span><span class="nf">add_column</span><span class="p">(</span><span class="n">H</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">v_t</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">.$Qt</span><span class="n">[1</span><span class="n">]</span><span class="o">/</span><span class="m">2</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v_t</span><span class="p">,</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">within</span><span class="p">(</span><span class="p">{</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">2</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span><span class="p">)</span><span class="p">{</span>
      <span class="n">H</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">Z</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">Z</span><span class="n">[1</span><span class="n">]</span>
      <span class="n">v</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">V</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">V</span><span class="n">[1</span><span class="n">]</span>
      <span class="n">v_t</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">v</span><span class="n">[i</span><span class="n">]</span><span class="o">/</span><span class="m">3600</span><span class="o">*</span><span class="m">100000000</span>
      <span class="n">f</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">v_t</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">Qt</span><span class="n">[i</span><span class="n">]</span><span class="o">/</span><span class="m">2</span>
    <span class="p">}</span>
  <span class="p">}</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>

<span class="n">tbl2</span> <span class="o">%&gt;%</span> 
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Qt</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_bw</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">geom_point</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="n">BS</span><span class="o">*</span><span class="s">&#39;</span><span class="s"> 水库 &#39;</span><span class="o">*</span><span class="n">q</span><span class="o">*</span><span class="s">&#39;</span><span class="s"> ~ &#39;</span><span class="o">*</span><span class="p">(</span><span class="nf">frac</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Delta</span><span class="o">*</span><span class="s">&#39;</span><span class="s">t&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">frac</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="p">)</span><span class="o">*</span><span class="s">&#39;</span><span class="s"> 辅助曲线&#39;</span><span class="p">)</span><span class="p">,</span>
       <span class="n">x</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="nf">frac</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Delta</span><span class="o">*</span><span class="s">&#39;</span><span class="s">t&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nf">frac</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="n">^3</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="n">q</span><span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="n">^3</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">scales</span><span class="o">::</span><span class="n">number</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">ylim</span><span class="p">(</span><span class="m">2000</span><span class="p">,</span> <span class="m">16000</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>
<p>As you can see, the figure generated in HTML is clearer than in RStudio&hellip; But I don't know why.</p>
<p>More expressions in R are available by calling <code>demo(plotmath)</code> or referring to  <a href="https://stat.ethz.ch/R-manual/R-devel/library/grDevices/html/plotmath.html">https://stat.ethz.ch/R-manual/R-devel/library/grDevices/html/plotmath.html</a>.</p>
<p>And more Greek letters used in R can be acquired by referring to <a href="http://kestrel.nmt.edu/~raymond/software/howtos/greekscape.xhtml">http://kestrel.nmt.edu/~raymond/software/howtos/greekscape.xhtml</a>.</p>
<a class="post-dummy-target" id="extra-dashed-lines"></a><h2>extra dashed lines</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span>

<span class="n">a</span> <span class="o">&lt;-</span> <span class="nf">read_xlsx</span><span class="p">(</span><span class="s">&#34;</span><span class="s">../../Excel/A.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">&lt;-</span> <span class="n">a</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span> <span class="m">-14</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.matrix</span><span class="p">(</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">t</span><span class="p">(</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as.vector</span><span class="p">(</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ts</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="m">12</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1951</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span><span class="p">)</span>

<span class="n">m</span> <span class="o">&lt;-</span> <span class="m">100</span><span class="p">;</span> <span class="n">kk</span> <span class="o">&lt;-</span> <span class="m">600</span><span class="p">;</span> <span class="n">m2</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">)</span><span class="p">;</span> <span class="n">s</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">,</span> <span class="n">kk</span><span class="p">)</span>
<span class="n">s</span><span class="n">[1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span><span class="p">;</span> <span class="n">d</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">,</span> <span class="n">kk</span><span class="p">)</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">)</span>

<span class="n">v</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">150</span><span class="p">,</span><span class="m">5</span><span class="p">)</span>

<span class="nf">for </span><span class="p">(</span><span class="n">k</span> <span class="n">in</span> <span class="nf">seq_along</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">m2</span><span class="n">[k</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span>
  <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">kk</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">d</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">x</span><span class="n">[i</span><span class="n">]</span>
      <span class="n">s</span><span class="n">[i</span> <span class="o">+</span> <span class="m">1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span>
      <span class="n">m2</span><span class="n">[k</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">m2</span><span class="n">[k</span><span class="n">]</span> <span class="o">+</span> <span class="m">1</span>
    <span class="p">}</span> <span class="n">else</span> <span class="nf">if </span><span class="p">(</span><span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">x</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">v</span><span class="n">[k</span><span class="n">]</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">d</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">m</span>
      <span class="n">s</span><span class="n">[i</span> <span class="o">+</span> <span class="m">1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">x</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">m</span>
    <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
      <span class="n">d</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">x</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">v</span><span class="n">[k</span><span class="n">]</span>
      <span class="n">s</span><span class="n">[i</span> <span class="o">+</span> <span class="m">1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">v</span><span class="n">[k</span><span class="n">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">p</span><span class="n">[k</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">kk</span> <span class="o">-</span> <span class="n">m2</span><span class="n">[k</span><span class="n">]</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">kk</span> <span class="o">+</span> <span class="m">1</span><span class="p">)</span> <span class="o">*</span> <span class="m">100</span>
<span class="p">}</span>

<span class="n">vp</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">t</span><span class="p">(</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">as_tibble</span><span class="p">(</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span><span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">background_grid</span><span class="p">(</span><span class="s">&#34;</span><span class="s">xy&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">P(%)&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="n">V</span><span class="n">[兴</span><span class="nf">]</span><span class="p">(</span><span class="n">m</span><span class="n">^3</span><span class="o">/</span><span class="n">s</span><span class="o">%.%</span>月<span class="p">)</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span> <span class="o">=</span> <span class="m">95</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">dashed&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">red&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="m">46.5</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">dashed&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">red&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>
<a class="post-dummy-target" id="the-legend"></a><h2>the legend</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">m</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">50</span><span class="p">,</span><span class="m">500</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span><span class="p">;</span> <span class="n">kk</span> <span class="o">&lt;-</span> <span class="m">600</span><span class="p">;</span> <span class="n">m2</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">)</span><span class="p">;</span> <span class="n">s</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">,</span> <span class="n">kk</span><span class="p">)</span>
<span class="n">s</span><span class="n">[1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span><span class="p">;</span> <span class="n">d</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">,</span> <span class="n">kk</span><span class="p">)</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">)</span>
<span class="n">v</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">200</span><span class="p">,</span> <span class="m">800</span><span class="p">,</span> <span class="m">100</span><span class="p">)</span><span class="p">;</span> <span class="n">mp</span> <span class="o">&lt;-</span> <span class="nf">tibble</span><span class="p">(</span><span class="p">)</span>

<span class="nf">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="nf">seq_along</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="p">)</span><span class="p">{</span>
  <span class="nf">for </span><span class="p">(</span><span class="n">k</span> <span class="n">in</span> <span class="nf">seq_along</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">m2</span><span class="n">[k</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">kk</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">if </span><span class="p">(</span><span class="n">x</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="n">[k</span><span class="n">]</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">d</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">x</span><span class="n">[i</span><span class="n">]</span>
        <span class="n">s</span><span class="n">[i</span> <span class="o">+</span> <span class="m">1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="m">0</span>
        <span class="n">m2</span><span class="n">[k</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">m2</span><span class="n">[k</span><span class="n">]</span> <span class="o">+</span> <span class="m">1</span>
      <span class="p">}</span> <span class="n">else</span> <span class="nf">if </span><span class="p">(</span><span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">x</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="n">[k</span><span class="n">]</span> <span class="o">+</span> <span class="n">v</span><span class="n">[j</span><span class="n">]</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">d</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">m</span><span class="n">[k</span><span class="n">]</span>
        <span class="n">s</span><span class="n">[i</span> <span class="o">+</span> <span class="m">1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">x</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">m</span><span class="n">[k</span><span class="n">]</span>
      <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
        <span class="n">d</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">s</span><span class="n">[i</span><span class="n">]</span> <span class="o">+</span> <span class="n">x</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">v</span><span class="n">[j</span><span class="n">]</span>
        <span class="n">s</span><span class="n">[i</span> <span class="o">+</span> <span class="m">1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">v</span><span class="n">[j</span><span class="n">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">p</span><span class="n">[k</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">kk</span> <span class="o">-</span> <span class="n">m2</span><span class="n">[k</span><span class="n">]</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">kk</span> <span class="o">+</span> <span class="m">1</span><span class="p">)</span> <span class="o">*</span> <span class="m">100</span>
  <span class="p">}</span>
  <span class="n">mp</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="n">[j</span><span class="n">]</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">t</span><span class="p">(</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">rbind</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">as_tibble</span><span class="p">(</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">mp</span><span class="o">$</span><span class="n">v</span> <span class="o">&lt;-</span> <span class="n">mp</span><span class="o">$</span><span class="n">v</span> <span class="o">%&gt;%</span>
  <span class="nf">as.factor</span><span class="p">(</span><span class="p">)</span>

<span class="n">title</span> <span class="o">&lt;-</span> <span class="nf">expression</span><span class="p">(</span><span class="nf">V</span><span class="p">(</span><span class="n">m</span><span class="n">^3</span><span class="o">/</span><span class="n">s</span><span class="o">%.%</span><span class="n">month</span><span class="p">)</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span><span class="n">v</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">P(%)&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="n">Q</span><span class="n">[p</span><span class="nf">]</span><span class="p">(</span><span class="n">m</span><span class="n">^3</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">title</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">10</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">background_grid</span><span class="p">(</span><span class="n">major</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">xy&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>
<p>Following shows how to break x-axis as you want:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">d1</span> <span class="o">&lt;-</span> <span class="n">data</span><span class="p">;</span> <span class="n">d2</span> <span class="o">&lt;-</span> <span class="n">data2</span>
<span class="n">tb</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">rename</span><span class="p">(</span>中水年 <span class="o">=</span> <span class="n">V12</span><span class="p">,</span> 枯水年 <span class="o">=</span> <span class="n">V2</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="n">V1</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">melt</span><span class="p">(</span><span class="n">id</span><span class="o">=</span><span class="s">&#34;</span><span class="s">month&#34;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">month</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">variable</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">月份&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span>出力<span class="o">/</span>万<span class="n">kW</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">background_grid</span><span class="p">(</span><span class="s">&#34;</span><span class="s">xy&#34;</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.justification</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="p">,</span> <span class="n">legend.position</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">)</span><span class="p">,</span><span class="n">legend.title</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">(</span><span class="p">)</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>When you meet with sequences of times and two or more sets of plot types, for example, <code>col</code> and <code>shape</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">reshape2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>

<span class="n">final</span> <span class="o">&lt;-</span> <span class="nf">read_xlsx</span><span class="p">(</span><span class="s">&#34;</span><span class="s">../../Excel/设计洪水配线计算.xlsx&#34;</span><span class="p">,</span>
                   <span class="n">sheet</span> <span class="o">=</span> <span class="m">9</span><span class="p">,</span> <span class="n">range</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">A20:E35&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">melt</span><span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">t&#34;</span><span class="p">)</span>
<span class="n">final</span><span class="o">$</span><span class="n">t</span> <span class="o">&lt;-</span> <span class="nf">ymd</span><span class="p">(</span><span class="n">final</span><span class="o">$</span><span class="n">t</span><span class="p">)</span>
<span class="n">final</span><span class="o">$</span><span class="n">variable</span> <span class="o">&lt;-</span> <span class="nf">str_replace</span><span class="p">(</span><span class="n">final</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&#34;</span><span class="s">P.&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">P=&#34;</span><span class="p">)</span>
<span class="n">final</span><span class="o">$</span><span class="n">variable</span> <span class="o">&lt;-</span> <span class="nf">str_replace</span><span class="p">(</span><span class="n">final</span><span class="o">$</span><span class="n">variable</span><span class="p">,</span><span class="s">&#34;</span><span class="s">2.&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">2%&#34;</span><span class="p">)</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">final</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">variable</span><span class="p">,</span><span class="n">shape</span> <span class="o">=</span> <span class="n">variable</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="p">)</span><span class="o">+</span>
  <span class="n">ggalt</span><span class="o">::</span><span class="nf">geom_xspline</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span> 
  <span class="c1"># theme(axis.text.x = element_text(angle = 45)) + </span>
  <span class="nf">scale_x_date</span><span class="p">(</span><span class="n">date_breaks</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">3 day&#34;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="c1"># theme(legend.position = &#34;none&#34;) +</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">设计洪水过程线&#34;</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&#34;</span><span class="s">时间&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">(h)&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="s">&#34;</span><span class="s">流量&#34;</span><span class="p">(</span><span class="n">m</span><span class="n">^3</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="p">)</span><span class="p">,</span><span class="n">shape</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="s">&#34;</span><span class="s">图例&#34;</span><span class="p">)</span><span class="p">,</span><span class="n">col</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span><span class="s">&#34;</span><span class="s">图例&#34;</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">background_grid</span><span class="p">(</span><span class="n">major</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">xy&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>
<a class="post-dummy-target" id="double-y-axis"></a><h2>double y-axis</h2>
<p><a href="http://www.10tiao.com/html/404/201808/2651058545/2.html">This method</a> changes the second variable's value to fit the first y-axis, which plays a trick on the second y-axis.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ReadAxfBOM</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">&lt;-</span> <span class="nf">ReadAxfBOM</span><span class="p">(</span><span class="s">&#34;</span><span class="s">http://www.bom.gov.au/fwo/IDV60901/IDV60901.94866.axf&#34;</span><span class="p">)</span>

<span class="n">p</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">air_temp</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Tempeture&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">rel_hum</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Humidity&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">sec.axis</span> <span class="o">=</span> <span class="nf">sec_axis</span><span class="p">(</span><span class="o">~</span><span class="n">.,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Relative humidity [%]&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_colour_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">blue&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">red&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Air temperature [°C]&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Date and time&#34;</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Parameter&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.8</span><span class="p">,</span> <span class="m">0.9</span><span class="p">)</span><span class="p">)</span>
<span class="n">p</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">q</span> <span class="o">&lt;-</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">air_temp</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Tempeture&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">rel_hum</span><span class="o">/</span><span class="m">5</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Humidity&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">sec.axis</span> <span class="o">=</span> <span class="nf">sec_axis</span><span class="p">(</span><span class="o">~</span><span class="n">.*5</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Relative humidity [%]&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_colour_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">blue&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">red&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Air temperature [°C]&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Date and time&#34;</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Parameter&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.8</span><span class="p">,</span> <span class="m">0.9</span><span class="p">)</span><span class="p">)</span>
<span class="n">q</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>
<p>And <a href="https://cloud.tencent.com/developer/article/1093077">this</a> is a similar method using range:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># lct &lt;- Sys.getlocale(&#34;LC_TIME&#34;)  </span>
<span class="c1">#备份本地默认日期显示格式</span>

<span class="c1"># Sys.setlocale(&#34;LC_TIME&#34;, &#34;C&#34;)    </span>
<span class="c1">#指定标准日期显示格式</span>

<span class="c1"># Sys.setlocale(&#34;LC_TIME&#34;,lct)     </span>
<span class="c1">#这一句是恢复默认系统日期显示格式</span>
<span class="c1">#（记得要在使用完下面的month函数之后再运行这一句，否则月份返回的是中文）</span>

<span class="nf">library</span><span class="p">(</span><span class="s">&#34;</span><span class="s">lubridate&#34;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#34;</span><span class="s">ggplot2&#34;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#34;</span><span class="s">scales&#34;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#34;</span><span class="s">magrittr&#34;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&#34;</span><span class="s">tidyr&#34;</span><span class="p">)</span>

<span class="n">data1</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span>
  <span class="n">Month</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="n">from</span> <span class="o">=</span> <span class="nf">as.Date</span><span class="p">(</span><span class="s">&#39;</span><span class="s">2017-01-01&#39;</span><span class="p">)</span><span class="p">,</span><span class="n">to</span><span class="o">=</span><span class="nf">as.Date</span><span class="p">(</span><span class="s">&#39;</span><span class="s">2017-06-01&#39;</span><span class="p">)</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s">&#39;</span><span class="s">1 month&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">lubridate</span><span class="o">::</span><span class="nf">month</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="p">,</span>
  <span class="n">Value</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">50</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">round</span><span class="p">(</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">data2</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span>
  <span class="n">Month</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="n">from</span> <span class="o">=</span> <span class="nf">as.Date</span><span class="p">(</span><span class="s">&#39;</span><span class="s">2017-01-01&#39;</span><span class="p">)</span><span class="p">,</span><span class="n">to</span><span class="o">=</span><span class="nf">as.Date</span><span class="p">(</span><span class="s">&#39;</span><span class="s">2017-06-01&#39;</span><span class="p">)</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="s">&#39;</span><span class="s">1 month&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">lubridate</span><span class="o">::</span><span class="nf">month</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="p">,</span>
  <span class="n">Categroy1</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">round</span><span class="p">(</span><span class="m">2</span><span class="p">)</span><span class="p">,</span>
  <span class="n">Categroy2</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">0.1</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">round</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
<span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">gather</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span><span class="n">Value</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_col</span><span class="p">(</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data1</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Month</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">Value</span><span class="p">)</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#34;</span><span class="s">#6794a7&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">data2</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Month</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nf">rescale</span><span class="p">(</span><span class="n">Value</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">55</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                             <span class="n">colour</span><span class="o">=</span><span class="n">Category</span><span class="p">,</span><span class="n">group</span><span class="o">=</span><span class="n">Category</span><span class="p">)</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">1.5</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">data2</span><span class="p">,</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">Month</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nf">rescale</span><span class="p">(</span><span class="n">Value</span><span class="p">,</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">55</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                              <span class="n">colour</span><span class="o">=</span><span class="n">Category</span><span class="p">)</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="m">21</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="s">&#34;</span><span class="s">white&#34;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">4</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">pretty_breaks</span><span class="p">(</span><span class="m">5</span><span class="p">)</span><span class="p">,</span>
                     <span class="n">sec.axis</span> <span class="o">=</span> <span class="nf">sec_axis</span><span class="p">(</span> <span class="o">~</span><span class="nf">rescale</span><span class="p">(</span><span class="nf">.,c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                                          <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Categroy&#34;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&#34;</span><span class="s">%d%%&#34;</span><span class="p">,</span><span class="p">(</span><span class="m">0</span><span class="o">:</span><span class="m">5</span><span class="p">)</span><span class="o">*</span><span class="m">10</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">scale_color_manual</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">Categroy1&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">Categroy2&#34;</span><span class="p">)</span><span class="p">,</span><span class="n">values</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">#ee8f71&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">#C10534&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s">&#34;</span><span class="s">This is a Title!&#34;</span><span class="p">,</span>
    <span class="n">subtitle</span><span class="o">=</span><span class="s">&#34;</span><span class="s">This is a Subtitle&#34;</span><span class="p">,</span>
    <span class="n">caption</span><span class="o">=</span><span class="s">&#34;</span><span class="s">This is a Caption&#34;</span>
  <span class="p">)</span><span class="o">+</span>
  <span class="nf">theme_minimal</span><span class="p">(</span><span class="n">base_size</span><span class="o">=</span><span class="m">16</span><span class="p">)</span> <span class="o">%+replace%</span> 
  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">plot.caption</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="p">,</span>
    <span class="n">plot.margin</span> <span class="o">=</span> <span class="nf">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">0.5</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0.5</span><span class="p">)</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">lines&#34;</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><!-- raw HTML omitted --></p>

        </div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>本文于 2019-01-05 更新</span>
            </div>
            <div class="post-info-license">
                
            </div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md">
                
                    
                        <span><a class="link-to-markdown" href="/2019/01/2019-01-05-ggplot2/index.md" target="_blank">阅读原始文档</a></span>
                    
                
            </div>
            <div class="post-info-share">
                
                    <span></span>
                
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section>
            
                
                    <span class="tag">
                        <a href="/tags/r/"><i class="fas fa-tag fa-fw"></i>R</a>
                    </span>
                
                    <span class="tag">
                        <a href="/tags/ggplot2/"><i class="fas fa-tag fa-fw"></i>ggplot2</a>
                    </span>
                
            
        </section>
        <section>
            <span><a href="javascript:window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        
            <a href="/2019/02/2019-02-12-tables-in-website/" class="next" rel="next" title="Tables in Website">Tables in Website<i class="fas fa-angle-right fa-fw"></i></a>
        
    </div>
</div>

        <div class="post-comment">
            
            

            
        </div>
    </article></div>
            </main>
            <footer class="footer">
    <div class="copyright">
        <div class="copyright-line">
            由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>
        <div class="copyright-line">
            <i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/">hoas</a></span><span class="license">&nbsp;|&nbsp;<a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
    <script>
        (function(u, c) {
         var d = document, t = 'script', o = d.createElement(t),
              s = d.getElementsByTagName(t)[0];
         o.src = u;
         if (c) { o.addEventListener('load', function(e) { c(e); }); }
         s.parentNode.insertBefore(o, s);
        })('//cdn.bootcss.com/pangu/3.3.0/pangu.min.js', function() {
            pangu.spacingPage();
            
        });
    </script>
</footer>


    
    




    
    




    
    





    
    



    
    



    
    





    
    





    
    



    
    





    
    




    
    




    
    



    
    





    
    


<script src="/js/lib/jquery/jquery.slim.min.min.js"></script>
<script src="/js/lib/lazysizes/lazysizes.min.min.js"></script>
<script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script>


    
    

    

    

    

    






<script src="/js/blog.min.js"></script>


    
</div>
        <a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll><span>&nbsp;</span></a>
    </body>
</html>