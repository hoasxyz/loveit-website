<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>水文水利计算课设总结 | hoas&#39; blog | One Stupid Boy</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="Website of hoas">
<link rel="prev" href="/2019/04/2019-04-08-settings-in-word/" />
<link rel="next" href="/2019/04/2019-04-27-update-r/" />
<link rel="canonical" href="/2019/04/2019-04-18-summary-of-course-design/" />
<link rel='shortcut icon' type='image/x-icon' href='/favicon.ico' />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="水文水利计算课设总结"/>
<meta name="twitter:description" content="两周多的水文水利计算课设我差不多已经做完了，我要对这10天来的迷茫、喜悦和成果做一个总结。Hadley说他每天写作时间为一个小时至一个半小时左右，我现在已经很赞同这个方式了——当然是基于我有了自己的网站哈哈。
这次课设我编了1500多行代码，还记得佘老师说本科教学阶段就是这个数，那我可以证明我已经达到了。其实也很正常，因为除非万不得已我都没有用Excel。
向Hadley致敬！
"/>
<script type="application/ld+json">
    {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "水文水利计算课设总结",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "\/2019\/04\/2019-04-18-summary-of-course-design\/"
    },
    
        "image": {
            "@type": "ImageObject",
            "url": "\/images\/hoas.png",
            "width":  800 ,
            "height":  600 
        },
    
    "genre": "posts",
    
        "keywords": "ggplot2, R",
    
    "wordcount":  4026 ,
    "url": "\/2019\/04\/2019-04-18-summary-of-course-design\/",
    
        "datePublished": "2019-04-18T00:00:00\x2b00:00",
    
    
        "dateModified": "2020-01-10T21:18:09\x2b08:00",
    
    
        "license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.",
    
    
        "publisher": {
            "@type": "Organization",
            "name": "XXXX",
            "logo": {
            "@type": "ImageObject",
            "url": "\/images\/hoas.png",
            "width":  127 ,
            "height":  40 
            }
        },
    
    
    "description": ""
    }
    </script>
<link rel="stylesheet" href="/css/style.min.css">
<link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.min.css">

<link rel="stylesheet" href="/css/lib/animate/animate.min.min.css">

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    </head>
    <body>
        <script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script>
        <div class="wrapper">
            <nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header">
            <a href="/">hoas&#39; blog | One Stupid Boy</a>
        </div>
        <div class="navbar-menu">
            
            
                <a class="menu-item" href="/posts/" title="">文章</a>
            
                <a class="menu-item" href="/tags/" title="">标签</a>
            
                <a class="menu-item" href="/categories/" title="">归档</a>
            
                <a class="menu-item" href="/about/" title="">关于</a>
            
            <a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a>
        </div>
    </div>
</nav>
<nav class="navbar-mobile">
     <div class="navbar-container">
        <div class="navbar-header">
            <div><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a><a href="/">hoas&#39; blog | One Stupid Boy</a></div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu">
            
            
                <a class="menu-item" href="/posts/" title="">文章</a>
            
                <a class="menu-item" href="/tags/" title="">标签</a>
            
                <a class="menu-item" href="/categories/" title="">归档</a>
            
                <a class="menu-item" href="/about/" title="">关于</a>
            
        </div>
    </div>
</nav><main class="main">
                <div class="container">
                    
    
    
    
       
    

    <article class="post-warp">
        <h1 class="post-title animated flipInX">水文水利计算课设总结</h1>

        <div class="post-meta">
            <div class="post-meta-main">
                <a class="author" href="/" rel="author"><i class="fas fa-user-circle fa-fw"></i>hoas&nbsp;</a>
                <span class="post-category">
                        收录于
                        <i class="far fa-folder fa-fw"></i>&nbsp;<a href="/categories/course/">course</a>
                            
                    </span>
            </div>
            <div class="post-meta-other">
                <i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-04-18>2019-04-18</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>约 4026 字&nbsp;
                <i class="far fa-clock fa-fw"></i>预计阅读 9 分钟&nbsp;</div>
        </div>

        

        <div class="post-toc" id="post-toc">
                <h2 class="post-toc-title">目录</h2>
                <div class="post-toc-content always-active">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#水文年整理">水文年整理</a></li>
    <li><a href="#最大715日洪量">最大7、15日洪量</a></li>
    <li><a href="#滑动平均值法">滑动平均值法</a></li>
  </ul>

  <ul>
    <li><a href="#spline-in-ggplot2">spline in ggplot2</a></li>
    <li><a href="#spline插值预测">spline插值预测</a></li>
    <li><a href="#改名方式">改名方式</a></li>
    <li><a href="#表格运算">表格运算</a></li>
    <li><a href="#clipboard">clipboard</a></li>
    <li><a href="#basictrendline">basicTrendline</a></li>
    <li><a href="#等出力调节">等出力调节</a></li>
    <li><a href="#xlsx导出">.xlsx导出</a></li>
    <li><a href="#ggplot2">ggplot2</a>
      <ul>
        <li><a href="#legend锚点">legend锚点</a></li>
        <li><a href="#点线">点线</a></li>
        <li><a href="#qplot">qplot</a></li>
        <li><a href="#零点对齐">零点对齐</a></li>
        <li><a href="#终极绘图">终极绘图</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
            </div>
            <div class="post-toc-mobile" id="post-toc-mobile">
                <details>
                    <summary><div class="post-toc-title"><span>目录</span><span><i class="details icon fas fa-angle-down"></i></span></div></summary>
                    <div class="post-toc-content">
                        
                        
                        <nav id="TableOfContentsMobile">
  <ul>
    <li><a href="#水文年整理">水文年整理</a></li>
    <li><a href="#最大715日洪量">最大7、15日洪量</a></li>
    <li><a href="#滑动平均值法">滑动平均值法</a></li>
  </ul>

  <ul>
    <li><a href="#spline-in-ggplot2">spline in ggplot2</a></li>
    <li><a href="#spline插值预测">spline插值预测</a></li>
    <li><a href="#改名方式">改名方式</a></li>
    <li><a href="#表格运算">表格运算</a></li>
    <li><a href="#clipboard">clipboard</a></li>
    <li><a href="#basictrendline">basicTrendline</a></li>
    <li><a href="#等出力调节">等出力调节</a></li>
    <li><a href="#xlsx导出">.xlsx导出</a></li>
    <li><a href="#ggplot2">ggplot2</a>
      <ul>
        <li><a href="#legend锚点">legend锚点</a></li>
        <li><a href="#点线">点线</a></li>
        <li><a href="#qplot">qplot</a></li>
        <li><a href="#零点对齐">零点对齐</a></li>
        <li><a href="#终极绘图">终极绘图</a></li>
      </ul>
    </li>
  </ul>
</nav>
                    </div>
                </details>
            </div>

        <div class="post-content">
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <p>两周多的水文水利计算课设我差不多已经做完了，我要对这10天来的迷茫、喜悦和成果做一个总结。Hadley说他每天写作时间为一个小时至一个半小时左右，我现在已经很赞同这个方式了——当然是基于我有了自己的网站哈哈。</p>
<p>这次课设我编了1500多行代码，还记得佘老师说本科教学阶段就是这个数，那我可以证明我已经达到了。其实也很正常，因为除非万不得已我都没有用Excel。</p>
<p>向Hadley致敬！</p>
<p><img src="https://rawcdn.githack.com/hoasxyz/mdphotos/c4d2e1f98761ad97aa876f1537f5c681086d4468/other/Hadley.png" alt="hadley"></p>
<a class="post-dummy-target" id="课设1"></a><h1>课设1</h1>
<a class="post-dummy-target" id="水文年整理"></a><h2>水文年整理</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">q</span> <span class="o">&lt;-</span> <span class="n">q</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="nf">ymd</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nf">ymd</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">year</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">5-1&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">-&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="nf">ymd</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nf">paste</span><span class="p">(</span><span class="nf">year</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">4-30&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">-&#34;</span><span class="p">)</span><span class="p">,</span>
  <span class="nf">year</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span><span class="p">,</span>
  <span class="nf">ifelse</span><span class="p">(</span><span class="nf">ymd</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nf">ymd</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">year</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">5-1&#34;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">-&#34;</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
    <span class="nf">year</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span>
    <span class="nf">year</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="bp">T</span><span class="p">)</span> <span class="o">+</span> <span class="m">1</span>
  <span class="p">)</span>
  <span class="p">)</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">dplyr</span><span class="o">::</span><span class="nf">filter</span><span class="p">(</span><span class="n">y</span> <span class="o">%in%</span> <span class="m">1954</span><span class="o">:</span><span class="m">2015</span><span class="p">)</span>

</code></pre></td></tr></table>
</div>
</div><p>这就已经直接整理出来了水文年划分后的年份。</p>
<a class="post-dummy-target" id="最大715日洪量"></a><h2>最大7、15日洪量</h2>
<p>平均和最大一日很简单，但是这个我却是<a href="https://d.cosx.org/d/420569-3">向别人求助</a>了的，不过用序列的方法更加适用于R：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># 求均值和最值</span>
<span class="n">qetc</span> <span class="o">&lt;-</span> <span class="n">q</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span>
    <span class="n">ave</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="p">,</span>
    <span class="n">max1</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ungroup</span><span class="p">(</span><span class="p">)</span>

<span class="c1"># 最大7/15日洪量</span>
<span class="n">max7</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">)</span>
<span class="n">index</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">)</span>
<span class="n">max7_1</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">)</span>
<span class="n">max15</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">(</span><span class="s">&#34;</span><span class="s">numeric&#34;</span><span class="p">)</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq_along</span><span class="p">(</span><span class="n">qetc</span><span class="o">$</span><span class="n">max1</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">max7</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">max</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="n">Q</span><span class="nf">[which</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="n">Q</span> <span class="o">==</span> <span class="n">qetc</span><span class="o">$</span><span class="n">max1</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span> <span class="o">+</span>
    <span class="p">(</span><span class="m">-7</span> <span class="o">+</span> <span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">0</span> <span class="o">+</span>
    <span class="nf">rep</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="m">7</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span><span class="n">]</span> <span class="o">%&gt;%</span>
    <span class="nf">matrix</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">apply</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">sum</span><span class="p">)</span><span class="p">)</span>
  <span class="n">index</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">which.max</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="n">Q</span><span class="nf">[which</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="n">Q</span> <span class="o">==</span> <span class="n">qetc</span><span class="o">$</span><span class="n">max1</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span> <span class="o">+</span>
    <span class="p">(</span><span class="m">-7</span> <span class="o">+</span> <span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">0</span> <span class="o">+</span>
    <span class="nf">rep</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="m">7</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span><span class="n">]</span> <span class="o">%&gt;%</span>
    <span class="nf">matrix</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">apply</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">sum</span><span class="p">)</span><span class="p">)</span>
  <span class="n">max7_1</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="n">Q</span><span class="nf">[which</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="n">Q</span> <span class="o">==</span> <span class="n">qetc</span><span class="o">$</span><span class="n">max1</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span> <span class="o">+</span>
    <span class="p">(</span><span class="m">-7</span> <span class="o">+</span> <span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">0</span> <span class="o">+</span>
    <span class="nf">rep</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="m">7</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span><span class="n">]</span> <span class="o">%&gt;%</span>
    <span class="nf">matrix</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="m">7</span><span class="p">)</span><span class="p">)</span><span class="n">[index</span><span class="n">[i</span><span class="n">]</span><span class="p">,</span> <span class="m">1</span><span class="n">]</span>
  <span class="n">max15</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">max</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="n">Q</span><span class="nf">[which</span><span class="p">(</span><span class="n">q</span><span class="o">$</span><span class="n">Q</span> <span class="o">==</span> <span class="n">max7_1</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span> <span class="o">+</span>
    <span class="p">(</span><span class="m">-15</span> <span class="o">+</span> <span class="m">6</span> <span class="o">+</span> <span class="m">1</span><span class="p">)</span><span class="o">:</span><span class="m">6</span> <span class="o">+</span>
    <span class="nf">rep</span><span class="p">(</span><span class="nf">seq_len</span><span class="p">(</span><span class="m">15</span><span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span> <span class="n">each</span> <span class="o">=</span> <span class="m">15</span><span class="p">)</span><span class="n">]</span> <span class="o">%&gt;%</span>
    <span class="nf">matrix</span><span class="p">(</span><span class="n">ncol</span> <span class="o">=</span> <span class="m">15</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">apply</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">sum</span><span class="p">)</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">qetc</span> <span class="o">&lt;-</span> <span class="n">qetc</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span>
    <span class="n">max7</span> <span class="o">=</span> <span class="n">max7</span> <span class="o">*</span> <span class="m">86400</span> <span class="o">/</span> <span class="m">100000000</span><span class="p">,</span>
    <span class="n">max15</span> <span class="o">=</span> <span class="n">max15</span> <span class="o">*</span> <span class="m">86400</span> <span class="o">/</span> <span class="m">100000000</span>
  <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="滑动平均值法"></a><h2>滑动平均值法</h2>
<p>见https://hoas.xyz/post/base-r-plot/#moving-average-method</p>
<a class="post-dummy-target" id="课设2"></a><h1>课设2</h1>
<a class="post-dummy-target" id="spline-in-ggplot2"></a><h2>spline in ggplot2</h2>
<p><a href="https://d.cosx.org/d/420602-ggplot2-spline-excel/4">受教</a>了！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">myspline</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">dat</span> <span class="o">=</span> <span class="nf">model.frame</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
  <span class="n">res</span> <span class="o">=</span> <span class="nf">splinefun</span><span class="p">(</span><span class="n">dat</span><span class="n">[</span><span class="n">[2</span><span class="n">]</span><span class="n">]</span><span class="p">,</span> <span class="n">dat</span><span class="n">[</span><span class="n">[1</span><span class="n">]</span><span class="n">]</span><span class="p">)</span>
  <span class="nf">class</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">myspline&#34;</span>
  <span class="n">res</span>
<span class="p">}</span>

<span class="n">predict.myspline</span> <span class="o">=</span> <span class="nf">function</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">newdata</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nf">object</span><span class="p">(</span><span class="n">newdata</span><span class="n">[</span><span class="n">[1</span><span class="n">]</span><span class="n">]</span><span class="p">)</span>
<span class="p">}</span>


<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="n">dat</span> <span class="o">=</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">xx</span> <span class="o">=</span> <span class="nf">runif</span><span class="p">(</span><span class="m">100</span><span class="p">,</span> <span class="m">-5</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span><span class="p">)</span>
<span class="n">dat</span><span class="o">$</span><span class="n">yy</span> <span class="o">=</span> <span class="nf">sin</span><span class="p">(</span><span class="n">dat</span><span class="o">$</span><span class="n">xx</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">xx</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">yy</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">myspline</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="spline插值预测"></a><h2>spline插值预测</h2>
<p>这次课设主要用的是spline插值拟合法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># 预测</span>
<span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">z_q</span><span class="o">$</span><span class="n">q</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">z_q</span><span class="o">$</span><span class="n">z</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="m">500</span><span class="p">)</span><span class="o">$</span><span class="n">y</span>
<span class="c1"># spline(x = z_q$z,y = z_q$q, xout = 90.50468)</span>

<span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">z_vaq</span><span class="o">$</span><span class="n">v</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">z_vaq</span><span class="o">$</span><span class="n">z</span><span class="p">,</span><span class="n">xout</span> <span class="o">=</span> <span class="n">v0</span><span class="p">)</span><span class="o">$</span><span class="n">y</span>

<span class="c1"># 插值</span>
<span class="n">ipl</span> <span class="o">&lt;-</span> <span class="nf">tibble</span><span class="p">(</span>
  <span class="n">n</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">361</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span>
  <span class="n">dx</span> <span class="o">=</span> <span class="nf">spline</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">,</span> <span class="n">dfplines</span><span class="o">$</span><span class="n">dx</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="m">361</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="p">)</span><span class="n">[</span><span class="n">[2</span><span class="n">]</span><span class="n">]</span><span class="p">,</span>
  <span class="n">xy</span> <span class="o">=</span> <span class="nf">spline</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">,</span> <span class="n">dfplines</span><span class="o">$</span><span class="n">xy</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="m">361</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="p">)</span><span class="n">[</span><span class="n">[2</span><span class="n">]</span><span class="n">]</span><span class="p">,</span>
  <span class="n">sj</span> <span class="o">=</span> <span class="nf">spline</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">,</span> <span class="n">dfplines</span><span class="o">$</span><span class="n">sj</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="m">361</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="p">)</span><span class="n">[</span><span class="n">[2</span><span class="n">]</span><span class="n">]</span><span class="p">,</span>
  <span class="n">jh</span> <span class="o">=</span> <span class="nf">spline</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">,</span> <span class="n">dfplines</span><span class="o">$</span><span class="n">jh</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="m">361</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">dfplines</span><span class="o">$</span><span class="n">n</span><span class="p">)</span><span class="p">)</span><span class="n">[</span><span class="n">[2</span><span class="n">]</span><span class="n">]</span>
<span class="p">)</span>
<span class="n">ipl_plot</span> <span class="o">&lt;-</span> <span class="n">ipl</span> <span class="o">%&gt;%</span> <span class="nf">gather</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="m">2</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>不过也可以用别的，比如loess，这个东西好像只有R有……</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># 预测值</span>
<span class="nf">predict</span><span class="p">(</span><span class="nf">loess</span><span class="p">(</span><span class="n">z</span> <span class="o">~</span> <span class="n">v</span><span class="p">,</span> <span class="n">z_vaq</span><span class="p">)</span><span class="p">,</span> <span class="m">8.07</span><span class="p">)</span>
<span class="nf">predict</span><span class="p">(</span><span class="nf">loess</span><span class="p">(</span><span class="n">z</span> <span class="o">~</span> <span class="n">q</span><span class="p">,</span> <span class="n">z_q</span><span class="p">)</span><span class="p">,</span> <span class="nf">mean</span><span class="p">(</span><span class="n">qetc</span><span class="o">$</span><span class="n">ave</span><span class="p">)</span><span class="p">)</span>
<span class="nf">predict</span><span class="p">(</span><span class="nf">loess</span><span class="p">(</span><span class="n">v</span> <span class="o">~</span> <span class="n">z</span><span class="p">,</span> <span class="n">z_vaq</span><span class="p">)</span><span class="p">,</span> <span class="m">140.516</span><span class="p">)</span>
<span class="nf">predict</span><span class="p">(</span><span class="nf">loess</span><span class="p">(</span><span class="n">z</span> <span class="o">~</span> <span class="n">v</span><span class="p">,</span> <span class="n">z_vaq</span><span class="p">)</span><span class="p">,</span> <span class="m">137.3906</span><span class="p">)</span>
<span class="nf">predict</span><span class="p">(</span><span class="nf">loess</span><span class="p">(</span><span class="n">z</span> <span class="o">~</span> <span class="n">v</span><span class="p">,</span> <span class="n">z_vaq</span><span class="p">)</span><span class="p">,</span> <span class="m">128.7758</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="改名方式"></a><h2>改名方式</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">names</span><span class="p">(</span><span class="n">dfplines</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">t&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">xy&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">sj&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">jh&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">dx&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>另外<code>janitor::clean_names()</code>可以用来整理变量名，适合英文的。</p>
<a class="post-dummy-target" id="表格运算"></a><h2>表格运算</h2>
<p>这个是让我感觉非常舒服的一点，表格形式的运算程序，<del>本人命名</del>简称<strong>表格运算</strong>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">ipl_xy</span> <span class="o">&lt;-</span> <span class="n">ipl</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">xy</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">rename</span><span class="p">(</span><span class="n">q_in</span> <span class="o">=</span> <span class="n">xy</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span>
    <span class="n">q_in_ave</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">q_out</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">q_out_ave</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span>
    <span class="n">delta_v</span> <span class="o">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="m">128.638</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="m">150.2847</span>
  <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">within</span><span class="p">(</span><span class="p">{</span>
    <span class="nf">for </span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="nf">seq_along</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">if </span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="nf">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="p">)</span> <span class="n">q_in_ave</span><span class="n">[i</span> <span class="o">+</span> <span class="m">1</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">q_in</span><span class="n">[i</span><span class="n">]</span><span class="p">,</span> <span class="n">q_in</span><span class="n">[i</span> <span class="o">+</span> <span class="m">1</span><span class="n">]</span><span class="p">)</span><span class="p">)</span>
      <span class="n">q_out</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">q_in</span><span class="n">[i</span><span class="n">]</span> <span class="o">&gt;=</span> <span class="m">15000</span><span class="p">,</span> <span class="m">15000</span><span class="p">,</span> <span class="n">q_in</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span>
      <span class="nf">if </span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">q_out_ave</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">q_out</span><span class="n">[i</span><span class="n">]</span><span class="p">,</span> <span class="n">q_out</span><span class="n">[i</span> <span class="o">-</span> <span class="m">1</span><span class="n">]</span><span class="p">)</span><span class="p">)</span>
        <span class="n">delta_v</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">q_in_ave</span><span class="n">[i</span><span class="n">]</span> <span class="o">-</span> <span class="n">q_out_ave</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span> <span class="o">*</span> <span class="m">3600</span> <span class="o">/</span> <span class="m">10</span><span class="n">^8</span>
        <span class="n">v</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="n">v</span><span class="n">[i</span> <span class="o">-</span> <span class="m">1</span><span class="n">]</span> <span class="o">+</span> <span class="n">delta_v</span><span class="n">[i</span><span class="n">]</span>
        <span class="c1"># z[i] &lt;- predict(loess(z ~ v, z_vaq), v[i])</span>
        <span class="n">z</span><span class="n">[i</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">spline</span><span class="p">(</span><span class="n">z_vaq</span><span class="n">[</span><span class="n">[2</span><span class="n">]</span><span class="n">]</span><span class="p">,</span> <span class="n">z_vaq</span><span class="n">[</span><span class="n">[1</span><span class="n">]</span><span class="n">]</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">v</span><span class="n">[i</span><span class="n">]</span><span class="p">)</span><span class="o">$</span><span class="n">y</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">select</span><span class="p">(</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>以上是一个典型的结构，从主数据里筛选、重命名、添加空变量，然后打开数据框进行编程计算，最后移走循环的小尾巴~</p>
<a class="post-dummy-target" id="clipboard"></a><h2>clipboard</h2>
<p>剪贴板操作也很有用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">temp</span> <span class="o">&lt;-</span> <span class="n">clipr</span><span class="o">::</span><span class="nf">read_clip</span><span class="p">(</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">as.numeric</span><span class="p">(</span><span class="p">)</span> <span class="c1"># R只能读取最直观的数据</span>
<span class="n">clipr</span><span class="o">::</span><span class="nf">clear_clip</span><span class="p">(</span><span class="p">)</span>
<span class="c1"># (predict(loess(z ~ v, z_vaq), temp) - error) %&gt;% clipr::write_clip()</span>
<span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">z_q</span><span class="o">$</span><span class="n">q</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">z_q</span><span class="o">$</span><span class="n">z</span><span class="p">,</span> <span class="n">xout</span> <span class="o">=</span> <span class="n">temp</span><span class="p">)</span><span class="o">$</span><span class="n">y</span> <span class="o">%&gt;%</span> <span class="n">clipr</span><span class="o">::</span><span class="nf">write_clip</span><span class="p">(</span><span class="p">)</span>
<span class="nf">spline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">z_vaq</span><span class="o">$</span><span class="n">v</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">z_vaq</span><span class="o">$</span><span class="n">z</span><span class="p">,</span><span class="n">xout</span> <span class="o">=</span>  <span class="n">temp</span><span class="p">)</span><span class="o">$</span><span class="n">y</span> <span class="o">%&gt;%</span> <span class="n">clipr</span><span class="o">::</span><span class="nf">write_clip</span><span class="p">(</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="basictrendline"></a><h2>basicTrendline</h2>
<p>可以直接用这个函数进行特定形式公式的拟合，精度相当高！而且拟合好后直接放入方程计算也很方便！</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">trendline</span><span class="p">(</span><span class="n">z_q</span><span class="o">$</span><span class="n">q</span><span class="p">,</span> <span class="n">z_q</span><span class="o">$</span><span class="n">z</span><span class="p">,</span>
  <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">power3P&#34;</span><span class="p">,</span> <span class="n">linecolor</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">blue2&#34;</span><span class="p">,</span>
  <span class="n">show.equation</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">show.Rpvalue</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
  <span class="n">xlab</span> <span class="o">=</span> <span class="nf">expression</span><span class="p">(</span>流量<span class="p">(</span><span class="n">m</span><span class="n">^3</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">水位(m)&#34;</span><span class="p">,</span> <span class="n">lwd</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">lty</span> <span class="o">=</span> <span class="m">3</span>
<span class="p">)</span>
<span class="n">z_q_fit</span> <span class="o">&lt;-</span> <span class="nf">trendline_summary</span><span class="p">(</span><span class="n">z_q</span><span class="o">$</span><span class="n">q</span><span class="p">,</span> <span class="n">z_q</span><span class="o">$</span><span class="n">z</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">power3P&#34;</span><span class="p">)</span>
<span class="n">z_q_fit_y</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">z_q_fit</span><span class="o">$</span><span class="n">parameter</span><span class="o">$</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="n">^z_q_fit</span><span class="o">$</span><span class="n">parameter</span><span class="o">$</span><span class="n">b</span> <span class="o">+</span> <span class="n">z_q_fit</span><span class="o">$</span><span class="n">parameter</span><span class="o">$</span><span class="n">c</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="等出力调节"></a><h2>等出力调节</h2>
<p>原来觉得还挺简单的（不要问了当然是使用R的原因），但是我又犯傻了……逆向推水量平衡公式也要变呀！！</p>
<a class="post-dummy-target" id="xlsx导出"></a><h2><code>.xlsx</code>导出</h2>
<p><strong>openxlsx</strong>包的导出还可以，如果把数据框都放在一个<code>list</code>中那么它还会给你分sheet。但是<code>utils::write.csv()</code>就不一样了，是全部塞在一个sheet中，我现在才知道为什么，因为<code>.csv</code>哪儿来的sheet……</p>
<a class="post-dummy-target" id="ggplot2"></a><h2>ggplot2</h2>
<a class="post-dummy-target" id="legend锚点"></a><h3>legend锚点</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r">  <span class="nf">theme</span><span class="p">(</span>
    <span class="n">plot.subtitle</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">vjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span>
    <span class="n">plot.caption</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">vjust</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span>
    <span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">,</span> <span class="n">legend.title</span> <span class="o">=</span> <span class="nf">element_blank</span><span class="p">(</span><span class="p">)</span><span class="p">,</span>
    <span class="n">legend.justification</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span><span class="p">,</span> <span class="n">legend.position</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.99</span><span class="p">,</span> <span class="m">0.99</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>最后一句的意思是将<strong>图例</strong>的右上角放在<strong>图像</strong>的右上角（0.9,0.9）处！</p>
<p>另外不想要图例标题以上代码已关。</p>
<a class="post-dummy-target" id="点线"></a><h3>点线</h3>
<p>一般来说图上的线可以用1.2个大小，辅助线可以用1个大小。点可以用2~3个大小。</p>
<a class="post-dummy-target" id="qplot"></a><h3>qplot</h3>
<p>现在才知道有些时候快速出图的确有用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">qplot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">z_vaq</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">smooth&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">point&#34;</span><span class="p">)</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="零点对齐"></a><h3>零点对齐</h3>
<p>顺便也把轴坐标的限制也加上了，另外还可以直接用<code>x/ylim()</code>来实现。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r">  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">expand</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span><span class="p">,</span><span class="n">limits</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">2600</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span> 
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="终极绘图"></a><h3>终极绘图</h3>
<p>高能预警，包含多种NB的函数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">n_10k</span> <span class="o">&lt;-</span> <span class="n">readxl</span><span class="o">::</span><span class="nf">read_xlsx</span><span class="p">(</span><span class="s">&#34;</span><span class="s">ks2.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">data&#34;</span><span class="p">,</span> <span class="n">range</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">D18:N32&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">gather</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="m">2</span><span class="o">:</span><span class="m">11</span><span class="p">)</span>

<span class="nf">ggplot</span><span class="p">(</span><span class="n">n_10k</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">year</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="n">year</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme_bw</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">1.1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">)</span><span class="p">,</span>
                     <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">5&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">6&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">7&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">8&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">9&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">10&#34;</span><span class="p">,</span>
                              <span class="s">&#34;</span><span class="s">11&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">12&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">1&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">2&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">3&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">4&#34;</span><span class="p">)</span><span class="p">,</span>
                     <span class="n">expand</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">ylim</span><span class="p">(</span><span class="m">140</span><span class="p">,</span><span class="m">160.5</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">年调节水电站基本调度线&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Z/m&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">t/月&#34;</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">枯水年组&#34;</span><span class="p">,</span> 
    <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">枯水年组&#34;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">枯水年组&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_death</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CCCC00&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">)</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1"># geom_hline(yintercept = z_xx, color = &#34;#666600&#34;, size = 1) +</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_normal</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CCCCFF&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_g</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CC9933&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_sj</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#009999&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_jh</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#FFCC33&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="m">5.5</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="n">z_g</span><span class="p">)</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;</span><span class="s">text&#34;</span><span class="p">,</span>
           <span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">2.5</span><span class="p">,</span> <span class="m">2.5</span><span class="p">,</span><span class="m">4.5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">4.5</span><span class="p">)</span><span class="p">,</span>
           <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">141.4</span><span class="p">,</span> <span class="m">151</span><span class="p">,</span> <span class="m">152.6</span><span class="p">,</span> <span class="m">158.2</span><span class="p">,</span> <span class="m">158.7</span><span class="p">,</span> <span class="m">160.2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">label</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[死</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[汛</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[正</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[高</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[设</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[校</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
           <span class="n">color</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">#CCCC00&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#CCCCFF&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#CC9933&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#009999&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#FFCC33&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;</span><span class="s">text&#34;</span><span class="p">,</span>
           <span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1.25</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">149</span><span class="p">,</span> <span class="m">155</span><span class="p">,</span> <span class="m">158.7</span><span class="p">,</span> <span class="m">160.2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">label</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">兴利区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">正常防洪区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">加大泄洪区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">非常泄洪区&#34;</span><span class="p">)</span><span class="p">)</span>

<span class="n">n_10k_mod</span> <span class="o">&lt;-</span> <span class="n">readxl</span><span class="o">::</span><span class="nf">read_xlsx</span><span class="p">(</span><span class="s">&#34;</span><span class="s">ks2.xlsx&#34;</span><span class="p">,</span> <span class="n">sheet</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">data&#34;</span><span class="p">,</span> <span class="n">range</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">D39:G66&#34;</span><span class="p">)</span>

<span class="n">n_10k_mod</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">gather</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">type</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">type</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="n">type</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">theme_bw</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">1.1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">)</span><span class="p">,</span>
                     <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">5&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">6&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">7&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">8&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">9&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">10&#34;</span><span class="p">,</span>
                              <span class="s">&#34;</span><span class="s">11&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">12&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">1&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">2&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">3&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">4&#34;</span><span class="p">)</span><span class="p">,</span>
                     <span class="n">expand</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">ylim</span><span class="p">(</span><span class="m">140</span><span class="p">,</span><span class="m">160.5</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">年调节水电站水库调度图&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Z/m&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">t/月&#34;</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">调度线&#34;</span><span class="p">,</span> 
       <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">调度线&#34;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">调度线&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_death</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CCCC00&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">)</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1"># geom_hline(yintercept = z_xx, color = &#34;#666600&#34;, size = 1) +</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_normal</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CCCCFF&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_g</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CC9933&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_sj</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#009999&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_jh</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#FFCC33&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="m">5.5</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="n">z_g</span><span class="p">)</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;</span><span class="s">text&#34;</span><span class="p">,</span>
           <span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">2.5</span><span class="p">,</span> <span class="m">2.5</span><span class="p">,</span><span class="m">4.5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">4.5</span><span class="p">)</span><span class="p">,</span>
           <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">141.4</span><span class="p">,</span> <span class="m">151</span><span class="p">,</span> <span class="m">152.6</span><span class="p">,</span> <span class="m">158.2</span><span class="p">,</span> <span class="m">158.7</span><span class="p">,</span> <span class="m">160.2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">label</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[死</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[汛</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[正</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[高</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[设</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[校</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
           <span class="n">color</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">#CCCC00&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#CCCCFF&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#CC9933&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#009999&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#FFCC33&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;</span><span class="s">text&#34;</span><span class="p">,</span>
           <span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">6.5</span><span class="p">,</span> <span class="m">6.5</span><span class="p">,</span> <span class="m">11.5</span><span class="p">,</span> <span class="m">1.25</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">142.5</span><span class="p">,</span> <span class="m">148.5</span><span class="p">,</span> <span class="m">150</span><span class="p">,</span> <span class="m">149</span><span class="p">,</span> <span class="m">155</span><span class="p">,</span> <span class="m">158.7</span><span class="p">,</span> <span class="m">160.2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">label</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">降低出力区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">保证出力区&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">加大出力区&#34;</span><span class="p">,</span>
                     <span class="s">&#34;</span><span class="s">兴利区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">正常防洪区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">加大泄洪区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">非常泄洪区&#34;</span><span class="p">)</span><span class="p">)</span>

<span class="n">n_10k_mod</span> <span class="o">%&gt;%</span>
  <span class="nf">gather</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">type</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">type</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="n">type</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">theme_bw</span><span class="p">(</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span><span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">1.1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">)</span><span class="p">,</span>
                     <span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">5&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">6&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">7&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">8&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">9&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">10&#34;</span><span class="p">,</span>
                              <span class="s">&#34;</span><span class="s">11&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">12&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">1&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">2&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">3&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">4&#34;</span><span class="p">)</span><span class="p">,</span>
                     <span class="n">expand</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">ylim</span><span class="p">(</span><span class="m">140</span><span class="p">,</span><span class="m">160.5</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">plot.title</span> <span class="o">=</span> <span class="nf">element_text</span><span class="p">(</span><span class="n">hjust</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">年调节水电站水库调度图&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">Z/m&#34;</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">t/月&#34;</span><span class="p">,</span> <span class="n">colour</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">调度线&#34;</span><span class="p">,</span> 
       <span class="n">linetype</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">调度线&#34;</span><span class="p">,</span> <span class="n">shape</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">调度线&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_death</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CCCC00&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">)</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="c1"># geom_hline(yintercept = z_xx, color = &#34;#666600&#34;, size = 1) +</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_normal</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CCCCFF&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_g</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#CC9933&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_sj</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#009999&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_hline</span><span class="p">(</span><span class="n">yintercept</span> <span class="o">=</span> <span class="n">z_jh</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#FFCC33&#34;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">z_xx</span><span class="p">,</span> <span class="n">xend</span> <span class="o">=</span> <span class="m">5.5</span><span class="p">,</span> <span class="n">yend</span> <span class="o">=</span> <span class="n">z_g</span><span class="p">)</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;</span><span class="s">text&#34;</span><span class="p">,</span>
           <span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">2.5</span><span class="p">,</span> <span class="m">2.5</span><span class="p">,</span><span class="m">4.5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">4.5</span><span class="p">)</span><span class="p">,</span>
           <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">141.4</span><span class="p">,</span> <span class="m">151</span><span class="p">,</span> <span class="m">152.6</span><span class="p">,</span> <span class="m">158.2</span><span class="p">,</span> <span class="m">158.7</span><span class="p">,</span> <span class="m">160.2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">label</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[死</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[汛</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[正</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[高</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[设</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
                     <span class="nf">expression</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="n">nabla</span><span class="p">,</span><span class="n">Z</span><span class="n">[校</span><span class="n">]</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">,</span>
           <span class="n">color</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">#CCCC00&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#666600&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#CCCCFF&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#CC9933&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#009999&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">#FFCC33&#34;</span><span class="p">)</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">annotate</span><span class="p">(</span><span class="s">&#34;</span><span class="s">text&#34;</span><span class="p">,</span>
           <span class="n">x</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">6.5</span><span class="p">,</span> <span class="m">6.5</span><span class="p">,</span> <span class="m">11.5</span><span class="p">,</span> <span class="m">1.25</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">y</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">142.5</span><span class="p">,</span> <span class="m">148.5</span><span class="p">,</span> <span class="m">150</span><span class="p">,</span> <span class="m">149</span><span class="p">,</span> <span class="m">155</span><span class="p">,</span> <span class="m">158.7</span><span class="p">,</span> <span class="m">160.2</span><span class="p">)</span><span class="p">,</span>
           <span class="n">label</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;</span><span class="s">降低出力区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">保证出力区&#34;</span><span class="p">,</span> <span class="s">&#34;</span><span class="s">加大出力区&#34;</span><span class="p">,</span>
                     <span class="s">&#34;</span><span class="s">兴利区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">正常防洪区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">加大泄洪区&#34;</span><span class="p">,</span><span class="s">&#34;</span><span class="s">非常泄洪区&#34;</span><span class="p">)</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>我现在真的可以说，Excel绘图确实比不过<strong>ggplot2</strong>了。</p>
<a class="post-dummy-target" id="答辩"></a><h1>答辩</h1>
<p>刚刚答辩回来，更新……</p>
<ol>
<li>
<p>又是在一些小细节上扣了分，水轮机适应最小水头为49m，就是在水头低于49m的时候等流量调节和等出力调节（<del>这里还好我没有附表老师没扣分……</del>）不能用，这一点和接下来的抽水蓄能水电站出力范围一样，别再搞错了！</p>
</li>
<li>
<p>成果报告书的结论部分，你要把属于成果或者是指标类型的东西明明白白地展示出来！</p>
</li>
</ol>
<ul>
<li>意义较大的指标，比如衡量一个库容大小的<strong>总库容</strong>指标；</li>
<li>这些指标宜多不宜少，比如你确定了装机台数，那么总装机虽然也确定下来了，但是谁TM知道一台机多少出力？就算之前写过，写在这不也更好吗？另外在你知道最大工作容量、重复容量和备用容量都是用来决定总装机的情况下，为什么还要把这些<strong>半成品</strong>放到结论里来？</li>
</ul>
<p>以上的结果就是扣了5分，我不知道是不是总分扣去5分，从某种程度上来讲还有5分裕度。张同学在排版上没我做得好，但是好像扣分比我少，这等等都是属于老师侧重的问题。下次记住这些东西了，虽然这次不怎么失风范，可是下次再犯这种细节错误，裕度可能就不止5分这么简单了。</p>
        </div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>本文于 2020-01-10 更新</span>
            </div>
            <div class="post-info-license">
                
            </div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md">
                
                    
                        <span><a class="link-to-markdown" href="/2019/04/2019-04-18-summary-of-course-design/index.md" target="_blank">阅读原始文档</a></span>
                    
                
            </div>
            <div class="post-info-share">
                
                    <span></span>
                
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section>
            
                
                    <span class="tag">
                        <a href="/tags/ggplot2/"><i class="fas fa-tag fa-fw"></i>ggplot2</a>
                    </span>
                
                    <span class="tag">
                        <a href="/tags/r/"><i class="fas fa-tag fa-fw"></i>R</a>
                    </span>
                
            
        </section>
        <section>
            <span><a href="javascript:window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav">
        
            <a href="/2019/04/2019-04-08-settings-in-word/" class="prev" rel="prev" title="Word设置汇总"><i class="fas fa-angle-left fa-fw"></i>Word设置汇总</a>
        
        
            <a href="/2019/04/2019-04-27-update-r/" class="next" rel="next" title="更新R">更新R<i class="fas fa-angle-right fa-fw"></i></a>
        
    </div>
</div>

        <div class="post-comment">
            
            

            
        </div>
    </article></div>
            </main>
            <footer class="footer">
    <div class="copyright">
        <div class="copyright-line">
            由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>
        <div class="copyright-line">
            <i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/">hoas</a></span><span class="license">&nbsp;|&nbsp;<a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
    <script>
        (function(u, c) {
         var d = document, t = 'script', o = d.createElement(t),
              s = d.getElementsByTagName(t)[0];
         o.src = u;
         if (c) { o.addEventListener('load', function(e) { c(e); }); }
         s.parentNode.insertBefore(o, s);
        })('//cdn.bootcss.com/pangu/3.3.0/pangu.min.js', function() {
            pangu.spacingPage();
            
        });
    </script>
</footer>


    
    




    
    




    
    





    
    



    
    



    
    





    
    





    
    



    
    





    
    




    
    




    
    



    
    





    
    


<script src="/js/lib/jquery/jquery.slim.min.min.js"></script>
<script src="/js/lib/lazysizes/lazysizes.min.min.js"></script>
<script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script>


    
    

    

    

    

    






<script src="/js/blog.min.js"></script>


    
</div>
        <a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll><span>&nbsp;</span></a>
    </body>
</html>