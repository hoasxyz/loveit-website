---
title: 路由器互联网断连事件
author: hoas
date: '2020-07-10'
slug: case of router disconnected from the Internet
categories:
  - notes
tags:
  - Internet
subtitle: ''
lastmod: '2020-07-10T16:29:25+08:00'
authorLink: ''
description: ''
hiddenFromHomePage: no
hiddenFromSearch: no
featuredImage: 'https://ask-fd.zol-img.com.cn/g5/M00/09/0C/ChMkJlnv-S2IKJkpAAD1cyE56AEAAhh1wOOBbUAAPWL469.gif'
featuredImagePreview: ''
toc:
  enable: yes
math:
  enable: no
lightgallery: no
license: CC BY-NC 4.0
---

两天前，县水利局水库科室里的两台电脑连接不上互联网，同时手机也连接不上无线网。于是，这个科室里的两个小白开始了他们的互联网信号连接的冒险之旅。

科室里有两个路由器，经过验查后发现科室里的 WiFi`888`和 `419E`分别与其对应，而我们通常连接的是`888`，两台备用电脑（win7，非局长专用电脑，无无线驱动）都是通过路由器连接的。在极大的上网需求~~和局长不在场~~的鼓舞下，我们恢复了`419E`路由器的出厂设置[^ 出厂设置]。

[^ 出厂设置]: 恢复出厂设置有两种方法：1，在大多数无线路由器或 ADSL 调制解调器的默认网关（IP: 192.168.1.1）中的恢复出厂设置里设置；2，直接按住路由器插孔旁的`Reset`键十秒。恢复出厂设置可以重置系统管理员（默认网关）的密码。

<!--more-->

当我们重置好并且设置了系统管理员（默认网关）的密码之后，发现无论是电脑还是手机都连不上`419E`对应的互联网，最后还是今天得知局里宽带的初始密码之后才解决。

## WAN 状态全为 0

由于 WAN 口连接的网线在科室以外的某处，我们无法找寻来源，所以不能确定互联网入户线路的种类（电话线入户、光纤入户和网线入户）。但是从默认网关中得知 WAN 状态全为 0：

![WAN 状态全为 0](https://i.loli.net/2020/07/10/1gkxo4SB86bhws3.jpg)

首先这里显示的是“**PPPoE按需/自动连接**”，我们在`网络参数-WAN 口设置`中的`WAN 口连接类型`里进行自动检测，检测的结果为 PPPoE，那就设置为 PPPoE。

这里有三个可能的结果，分别是：

- PPPoE。PPPoE 拨号上网，又叫做 ADSL 拨号上网、宽带拨号上网，采用 PPPoE 协议。这种上网方式，宽带运营商会分配一个宽带账号、宽带密码给用户，每次拨号 ISP 给你分配一个 IP，这个 IP 可以固定给你，也可以每次都不一样，**大部分时间都是动态随机分配**（因此在本地连接 X 状态属性中的 IPv4 属性中可以默认自动获得 IP 地址和 DNS 服务器地址……）：**在未使用路由器的情况下，电脑上需要使用 “宽带连接” 拨号来实现上网**，而目前国内绝大多数用户办理的宽带，都属于  PPPoE 拨号这种类型；在使用路由器的情况下，无需“宽带连接”拨号，只需要插入网线后，在默认网关里输入好正确的宽带账号和密码。

- 动态 IP。动态 IP 地址（Dynamic IP）指的是在需要的时候才进行 IP 地址分配的方式。动态 IP 地址和静态 IP 地址是对应的。所谓动态就是指当你每一次上网时，运营商会**随机分配**一个 IP 地址，静态指的是**固定分配**一个 IP 地址，每次都用这一个地址。由于 IP 地址资源很宝贵，因此大部分用户上网都是使用动态 IP 地址的，比如通过 Modem、ISDN、ADSL、有线宽频、小区宽频等方式上网的计算机，都是在每次上网的时候临时分配一个 IP 地址。动态 IP 上网，又叫做 DHCP 上网、自动获取 IP 上网。动态 IP 这种上网方式，在未使用路由器的情况下，只需要把这根宽带网线连接到电脑上，电脑上的 IP 地址设置为自动获得，电脑就可以实现上网了。
  - 当你从邻居家路由器那里连一条线过来，然后自己又想再用一个路由器分几台电脑，上头的路由器用的是 DHCP 分配 IP 地址的，那下头的路由器就要用动态 IP，让路由器自动获取 IP 地址。不用输入任何东西。
  - 设置动态 IP 连接有一点要非常非常注意的地方。就是要更改 LAN 接口的 IP 地址。更改成除 192.168.1.1 所在的网段之外的其它网段，如 192.168.2.1 或者 172.16.0.1 都行。因为现在大部分路由器厂商设置的 LAN 接口的 IP 地址都是 192.168.1.1，下头路由器 WAN 接口从上头路由器那里获取的 IP 地址一般都是 192.168.1.1 所在的网段，这会和下头 LAN 接口的网段冲突，获取不到 IP 地址的，也就是上不了网。说简单点就是一个路由器的 WAN 外网接口和 LAN 内网接口不能是同一个网段。
  
- 静态 IP。静态 IP 地址（又称固定 IP 地址）是长期分配给一台计算机或网络设备使用的 IP 地址。一般来说是特殊的服务器或者采用专线上网的计算机才拥有固定的 IP 地址而且需要比较昂贵的费用。静态 IP 是二级路由必须用到的，网吧局域网也是使用静态 IP。这种上网方式，宽带运营商会提供一个 IP 地址、子网掩码、网关和 DNS 服务器地址给用户。在未使用路由器的情况下，只需要把这根入户网线连接到电脑上，并且手动设置电脑上的 IP 地址，这样电脑才能上网。

设置路由器上网，选择上网方式的时候，以下是选择的基本原则：

1. 如果你有宽带帐号、宽带密码；就选择 PPPoE 拨号（宽带拨号、ADSL 拨号）。

2. 如果宽带运营商给你提供了 IP 地址、子网掩码、网关和 DNS 服务器地址；那么就应该选择静态 IP（固定 IP）。
3. 如果宽带运营商只提供了一根网线到用户家里，没有宽带帐号、密码；也没有 IP 地址、子网掩码、网关和 DNS。这种情况下就应该选择动态 IP（DHCP、自动获取 IP）。

由上述知识点可知，解决这个问题的方法就是找到宽带密码。

## RouterPassView

在正确地输入宽带账号密码之后，可以在默认网关中**备份配置文件**。文件名为`config.bin`，是一个保存了宽带账号密码和 WiFi 密码的二进制文件，使用软件 [RouterPassView](https://www.nirsoft.net/utils/router_password_recovery.html) 打开后可以查看相应的账号和密码。

![RouterPassView 结果](https://i.loli.net/2020/07/10/LBDdmGkh1xWaEK3.jpg)

默认的宽带密码很短，在默认网关中所显示的 13 个小黑点应该代表可设置的密码长度的上限。